# InlineHook — модуль для реализации inline (trampoline) хуков

## Summary

Модуль `InlineHook` предназначен для низкоуровневого перехвата выполнения функций в x86-приложениях (например, WoW 3.3.5a) путём подмены первых байт целевой функции на jmp-инструкцию (inline hook/trampoline hook).

- `InlineHook` — абстрактный базовый класс. Для каждого конкретного случая (например, для разных функций или особенностей перехвата) необходимо создавать наследника и реализовывать метод `generateTrampoline()`.
- В модуле нет универсального трамплина: логику перехода на оригинальный код (trampoline) реализует каждый наследник самостоятельно.
- Для работы требуется объект `MemoryManager` (работа с памятью процесса).
- Поддерживается логирование через Qt QLoggingCategory.

## Основные классы

- `InlineHook` — абстрактный класс, реализует базовую логику установки/снятия хука, хранения оригинальных байт, патчинга и восстановления.
- Наследники (пример: `CharacterHook`, `CtMEnablerHook`) реализуют `generateTrampoline()` и могут добавлять свою логику (например, обработку контекста, вызов оригинала и т.д.).

## Usage (пример использования)

```cpp
// Пример: создание собственного inline-хука
class MyHook : public InlineHook {
public:
    MyHook(uintptr_t addr, uintptr_t handler, MemoryManager* mem)
        : InlineHook(addr, handler, mem) {}
    bool generateTrampoline() override {
        // Здесь реализуется логика трамплина (копирование оригинальных байт, вставка jmp и т.д.)
        return true;
    }
};

// Использование:
MyHook* hook = new MyHook(targetAddr, handlerAddr, memoryManager);
hook->install();
// ...
hook->uninstall();
delete hook;
```

## Важно

- **Трамплин (trampoline) не реализован в базовом классе!** Каждый наследник должен реализовать свою логику перехода на оригинальный код.
- Методы setHandler/remove/и т.п. реализуются в наследниках, если требуется специфичная обработка.
- Для x86-хуков обычно требуется сохранять оригинальные байты и корректно возвращаться в функцию после своего обработчика.

## Советы по расширению

- Для новых хуков всегда создавайте отдельный класс-наследник от InlineHook.
- Реализуйте generateTrampoline() под конкретную задачу (копирование оригинальных инструкций, вставка jmp, обработка контекста).
- Используйте MemoryManager для безопасной работы с памятью процесса.
- Добавляйте подробные комментарии и логирование для отладки.

## Примеры

- Пример реализации см. в `CharacterHook`, `CtMEnablerHook`.
- Для типовых задач копируйте структуру этих классов и адаптируйте под свой адрес/логику.

---

**Документация актуальна на: 10.05.2025**
