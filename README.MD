MDBot2 — Платформа для автоматизации World of Warcraft
MDBot2 — это модульная платформа на C++20 и Qt6, предназначенная для разработки ботов и средств автоматизации для игры World of Warcraft (версия 3.3.5a). Проект построен на современной кодовой базе с четким разделением логики, что обеспечивает гибкость, расширяемость и простоту сопровождения.
Ключевые технологии
Язык: C++20
Фреймворк UI: Qt6
Система сборки: CMake
Менеджер зависимостей: vcpkg
Внешние библиотеки:
Qt6: Для создания графического пользовательского интерфейса.
Capstone: Движок дизассемблера для безопасного создания inline-хуков.

Архитектура взаимодействия
Проект перешел от чисто внешней модели работы с памятью к гибридной клиент-серверной архитектуре, где основное приложение и инжектируемая в игру DLL взаимодействуют через общую память (Shared Memory). Это значительно повышает производительность и стабильность сбора данных.
MDBot2.exe (Основное приложение): Выступает в роли "мозгового центра" или "клиента".
Отвечает за пользовательский интерфейс (GUI), высокоуровневую логику принятия решений (например, выбор цели, построение маршрута).
При подключении к процессу игры инжектирует в него MDBot_Client.dll.
Создает блок общей памяти (Shared Memory), который служит каналом для получения данных от DLL.
В основном цикле пассивно читает данные из общей памяти и обновляет состояние своих менеджеров (GameObjectManager, Character).
MDBot_Client.dll (Клиентская DLL): Выступает в роли "агента" или "поставщика данных", работая непосредственно внутри игрового процесса.
После инъекции подключается к уже созданному блоку общей памяти.
Устанавливает внутриигровые хуки для эффективного перехвата информации.
Используется двухступенчатая система хуков для сбора данных об объектах:
Хук-сборщик (VisibleObjectsHook): Ставится на очень часто вызываемую функцию. Его единственная задача — максимально быстро собрать указатели на все видимые игровые объекты.
Хук-обработчик (GameLoopHook): Ставится на функцию, вызываемую реже (например, в основном цикле игры). Он забирает собранные указатели, читает по ним всю необходимую информацию (тип, здоровье, координаты), формирует из них структуру SharedData и записывает ее в общую память.
Такой подход минимизирует задержки в критически важных функциях игры.
Shared Memory (Общая память): Является "контрактом" и каналом связи между MDBot2.exe и MDBot_Client.dll.
Структура данных (SharedData) четко определена в библиотеке Core_Shared, доступной обоим модулям.
Это устраняет необходимость в медленных межпроцессных вызовах ReadProcessMemory для массового сбора данных и делает систему более отзывчивой.

Структура проекта
.
├── CMakeLists.txt
├── README.md
├── src
│   ├── main.cpp
│   ├── client                # <-- НОВЫЙ МОДУЛЬ: Код для DLL
│   │   ├── CMakeLists.txt
│   │   ├── DllMain.cpp
│   │   ├── Core
│   │   └── Hooks
│   ├── shared                # <-- НОВЫЙ МОДУЛЬ: Общий код
│   │   ├── CMakeLists.txt
│   │   ├── Data
│   │   │   └── SharedData.h  # "Контракт" для общей памяти
│   │   ├── Structures        # Структуры игровых объектов
│   │   └── Utils
│   ├── core                  # Ядро основного приложения
│   │   ├── CMakeLists.txt
│   │   ├── Bot
│   │   ├── Character
│   │   ├── GameObjectManager # Теперь работает с данными из Shared Memory
│   │   ├── HookManager       # Хуки для основного приложения
│   │   ├── InjectionManager  # <-- НОВЫЙ МОДУЛЬ: Логика инъекции DLL
│   │   ├── MemoryManager
│   │   ├── Navigation
│   │   └── SharedMemoryManager # <-- НОВЫЙ МОДУЛЬ: Управление общей памятью
│   └── gui                   # Графический интерфейс
└── tools
    └── MDHack


Описание библиотек и модулей
Главный исполняемый файл (MDBot2)
Основная точка входа. Отвечает за инициализацию Qt, создание главного окна и запуск цикла обработки событий. Линкуется со всеми Core_* библиотеками.
Core-библиотеки (src/core)
Статические библиотеки, содержащие логику основного приложения.
Core_MemoryManager: Фундаментальная библиотека для взаимодействия с памятью другого процесса (OpenProcess, Read/WriteProcessMemory, VirtualAllocEx). Используется для установки хуков, записи команд (например, Click-to-Move) и чтения одиночных значений.
Core_ProcessManager: Поиск и перечисление процессов в системе.
Core_InjectionManager: (Новое) Отвечает за инъекцию MDBot_Client.dll в целевой процесс игры.
Core_SharedMemoryManager: (Новое) Управляет созданием и доступом к блоку общей памяти со стороны основного приложения.
Core_HookManager: Управление хуками, которые устанавливаются из основного приложения. Сюда входят хуки, не связанные с массовым сбором данных, например:
GetComputerNameHook: Обход систем защиты.
CharacterHook: Получение указателя на структуру персонажа.
CtMEnablerHook: Активация функции "Click-to-Move".
Core_Character: Управление данными игрового персонажа. Получает базовый адрес через CharacterHook и читает данные по смещениям.
Core_GameObject: (Изменено) Ранее этот модуль сам сканировал память в поисках объектов. Теперь его основная задача — быть кэшем. Он получает готовые данные об объектах из общей памяти, создает/обновляет/удаляет их в своей внутренней структуре и предоставляет к ним доступ для высокоуровневой логики.
Core_Teleport: Реализация функционала телепортации.
Модуль Bot (src/core/Bot)
Центральный класс, управляющий одним экземпляром бота.
Bot.h/.cpp: (Изменено) Теперь при создании Bot происходит инъекция DLL и создание общей памяти. Основной цикл run() читает данные из SharedMemoryManager и передает их в GameObjectManager для обновления.
Клиентская DLL (src/client)
Динамическая библиотека MDBot_Client.dll, которая инжектируется в процесс игры.
Назначение: Выполнять быстрый и эффективный сбор данных непосредственно в адресном пространстве игры.
DllMain.cpp: Точка входа DLL. В соответствии с лучшими практиками, она не выполняет сложной логики, а лишь создает отдельный поток для инициализации.
Hooks: Содержит хуки, работающие внутри игры:
VisibleObjectsHook: Хук-"сборщик", который на очень часто вызываемой функции собирает указатели на объекты.
GameLoopHook: Хук-"обработчик", который периодически обрабатывает собранные указатели, читает по ним данные (используя структуры из Core_Shared) и отправляет результат в MDBot2.exe через общую память.
Общая библиотека (src/shared)
Интерфейсная (header-only) библиотека, код которой используется и основным приложением, и DLL.
Назначение: Обеспечить "контракт" для взаимодействия.
SharedData.h: Определяет точную структуру данных, передаваемых через общую память. Любые изменения здесь должны быть синхронизированы в обоих модулях.
Structures: Содержит C++ определения структур игровых объектов (WorldObject, Unit, Player, GameObject) с правильными смещениями полей. Это позволяет DLL безопасно "накладывать" эти структуры на сырые указатели в памяти и читать данные.
Графический интерфейс (src/gui)
Модули на Qt6, отвечающие за визуальное представление и взаимодействие с пользователем. Их структура осталась прежней.