# MDBot2 — Платформа для автоматизации World of Warcraft (боты)

## Ключевые технологии

  **Язык:** C++20
   **Фреймворк UI:** Qt6
  **Система сборки:** CMake
   **Менеджер зависимостей:** vcpkg
  **Внешние библиотеки:**
     **Qt6:** Для создания графического пользовательского интерфейса.
       **Capstone:** Движок дизассемблера для безопасного создания inline-хуков.

## Архитектура

Проект использует гибридную клиент-серверную архитектуру, где основное приложение (`MDBot2.exe`) и инжектируемая в игру DLL (`MDBot_Client.dll`) взаимодействуют через общую память (Shared Memory).

### Сбор данных (DLL ↔ Shared Memory)

  **`MDBot_Client.dll` (Агент):** Работает внутри игрового процесса. Его единственная задача — максимально быстро и эффективно собирать "сырые" данные о мире (координаты игрока, видимые объекты, их здоровье и т.д.) с помощью внутриигровых хуков и записывать их в общую память.
  **`Shared Memory` (Канал связи):** Область памяти, выступающая в роли "контракта" и быстрого канала для передачи данных от DLL к основному приложению. Это устраняет необходимость в медленных вызовах `ReadProcessMemory` для массового сбора информации.

### Принятие решений (Behavior Tree)

  **`MDBot2.exe` (Мозговой центр):** Выполняет всю высокоуровневую логику. Его работа построена на архитектуре **Деревьев Поведения (Behavior Trees)**.
    1.  **Основной цикл (`Bot::run`)** стал предельно простым. В каждой итерации ("тике") он читает свежие данные из общей памяти и обновляет состояние своих менеджеров (`GameObjectManager`, `Character`).
    2.  После обновления данных он делает один "тик" активного Дерева Поведения.
    3.  **Дерево Поведения** — это "мозг" бота. Оно представляет собой иерархическую структуру "навыков" и условий. Проходя по дереву сверху вниз, бот принимает решение, что ему делать в данный момент: атаковать, двигаться, собирать ресурс или ждать.
    4.  Такой подход делает логику модульной, читаемой и легко расширяемой, в отличие от громоздких `if-else` конструкций.

Структура проекта
.
├── CMakeLists.txt
├── README.md
├── src
│   ├── main.cpp
│   ├── client                # <-- НОВЫЙ МОДУЛЬ: Код для DLL
│   │   ├── CMakeLists.txt
│   │   ├── DllMain.cpp
│   │   ├── Core
│   │   └── Hooks
│   ├── shared                # <-- НОВЫЙ МОДУЛЬ: Общий код
│   │   ├── CMakeLists.txt
│   │   ├── Data
│   │   │   └── SharedData.h  # "Контракт" для общей памяти
│   │   ├── Structures        # Структуры игровых объектов
│   │   └── Utils
│   ├── core                  # Ядро основного приложения
│   │   ├── BehaviorTree
│   │   ├── Bot
│   │   |   ├── Behaviors/    Библиотека "навыков" бота (Действия и Условия)
│   │   |   ├── Modules/      Библиотека "модулей" (Планы/Стратегии)
│   │   |   |── Bot.h/.cpp    Главный класс, управляющий одним ботом
│   │   |   | - Character
│   │   |   ├── GameObjectManager Работает со списком обьектов
|   |   |   ├── MovementManager CtM, и т.д
│   │   ├── HookManager       # Хуки для основного приложения
│   │   ├── InjectionManager  # <-- НОВЫЙ МОДУЛЬ: Логика инъекции DLL
│   │   ├── MemoryManager
│   │   ├── Navigation
│   │   └── SharedMemoryManager Управление общей памятью
│   └── gui                   # Графический интерфейс
└── tools
    └── MDHack


Описание библиотек и модулей
Главный исполняемый файл (MDBot2)
Основная точка входа. Отвечает за инициализацию Qt, создание главного окна и запуск цикла обработки событий. Линкуется со всеми Core_* библиотеками.
Core-библиотеки (src/core)
Статические библиотеки, содержащие логику основного приложения.
Core_MemoryManager: Фундаментальная библиотека для взаимодействия с памятью другого процесса (OpenProcess, Read/WriteProcessMemory, VirtualAllocEx). Используется для установки хуков, записи команд (например, Click-to-Move) и чтения одиночных значений.
Core_ProcessManager: Поиск и перечисление процессов в системе.
Core_InjectionManager: (Новое) Отвечает за инъекцию MDBot_Client.dll в целевой процесс игры.
Core_SharedMemoryManager: (Новое) Управляет созданием и доступом к блоку общей памяти со стороны основного приложения.
Core_HookManager: Управление хуками, которые устанавливаются из основного приложения. Сюда входят хуки, не связанные с массовым сбором данных, например:
    **`Core_BehaviorTree` (Новое)**: Универсальный, переиспользуемый "движок" для построения Деревьев Поведения. Содержит базовые классы-инструменты (`BTNode`, `SequenceNode` и т.д.), которые ничего не знают о логике самой игры.

   **`Bot.h/.cpp`**: Главный класс, управляющий одним персонажем. Он владеет всеми менеджерами, создает "контекст" (`BTContext`) для дерева и в своем основном цикле `run()` "тикает" активный "мозг" (корень дерева).

  **`Behaviors/` (Навыки)**: Библиотека мелких, атомарных и переиспользуемых действий и условий. Это "кирпичики LEGO", из которых строится поведение. Каждый "навык" решает одну конкретную задачу.
    *   *Примеры:* `FindGameObjectByTypeAction` (найти объект), `MoveToTargetAction` (подойти к цели), `IsHealthLowCondition` (проверить здоровье).
    *   "Навыки" являются специфичными для игры и активно используют менеджеры (`GameObjectManager`, `MovementManager`) для выполнения своей работы.

   **`Modules/` (Модули)**: Библиотека высокоуровневых "планов" или "стратегий". Каждый модуль отвечает за определенный режим работы бота (гринд, квестинг и т.д.).
    *   Основная задача модуля — предоставить статический метод `build()`, который **собирает** из "навыков" (`Behaviors`) полноценное и сложное Дерево Поведения для конкретной задачи.
    *   *Пример:* `OreGrindModule` строит дерево, которое последовательно использует навыки "Найти руду", а затем "Подойти к руде".
GetComputerNameHook: Обход систем защиты.
CharacterHook: Получение указателя на структуру персонажа.
CtMEnablerHook: Активация функции "Click-to-Move".
Core_Character: Управление данными игрового персонажа. Получает базовый адрес через CharacterHook и читает данные по смещениям.
Core_GameObject: (Изменено) Ранее этот модуль сам сканировал память в поисках объектов. Теперь его основная задача — быть кэшем. Он получает готовые данные об объектах из общей памяти, создает/обновляет/удаляет их в своей внутренней структуре и предоставляет к ним доступ для высокоуровневой логики.
Core_Teleport: Реализация функционала телепортации.
Модуль Bot (src/core/Bot)
Центральный класс, управляющий одним экземпляром бота.
Bot.h/.cpp: (Изменено) Теперь при создании Bot происходит инъекция DLL и создание общей памяти. Основной цикл run() читает данные из SharedMemoryManager и передает их в GameObjectManager для обновления.
Клиентская DLL (src/client)
Динамическая библиотека MDBot_Client.dll, которая инжектируется в процесс игры.
Назначение: Выполнять быстрый и эффективный сбор данных непосредственно в адресном пространстве игры.
DllMain.cpp: Точка входа DLL. В соответствии с лучшими практиками, она не выполняет сложной логики, а лишь создает отдельный поток для инициализации.
Hooks: Содержит хуки, работающие внутри игры:
VisibleObjectsHook: Хук-"сборщик", который на очень часто вызываемой функции собирает указатели на объекты.
GameLoopHook: Хук-"обработчик", который периодически обрабатывает собранные указатели, читает по ним данные (используя структуры из Core_Shared) и отправляет результат в MDBot2.exe через общую память.
Общая библиотека (src/shared)
Интерфейсная (header-only) библиотека, код которой используется и основным приложением, и DLL.
Назначение: Обеспечить "контракт" для взаимодействия.
SharedData.h: Определяет точную структуру данных, передаваемых через общую память. Любые изменения здесь должны быть синхронизированы в обоих модулях.
Structures: Содержит C++ определения структур игровых объектов (WorldObject, Unit, Player, GameObject) с правильными смещениями полей. Это позволяет DLL безопасно "накладывать" эти структуры на сырые указатели в памяти и читать данные.
Графический интерфейс (src/gui)
Модули на Qt6, отвечающие за визуальное представление и взаимодействие с пользователем. Их структура осталась прежней.

### Клиентская DLL и Общая библиотека

Их структура и назначение остаются прежними: `MDBot_Client.dll` поставляет данные, а `shared` определяет "контракт" этих данных.