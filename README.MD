MDBot2 — Платформа для автоматизации World of Warcraft
MDBot2 — это модульная платформа на C++20 и Qt6, предназначенная для разработки ботов и средств автоматизации для игры World of Warcraft (версия 3.3.5a). Проект построен на современной кодовой базе с четким разделением логики, что обеспечивает гибкость, расширяемость и простоту сопровождения.
Ключевые технологии
Язык: C++20
Фреймворк UI: Qt6
Система сборки: CMake
Менеджер зависимостей: vcpkg
Внешние библиотеки:
Qt6: Для создания графического пользовательского интерфейса.
Capstone: Движок дизассемблера для безопасного создания inline-хуков.
Recast & Detour: Библиотеки для построения навигационных сеток (NavMesh) и поиска пути.
Архитектура
Проект имеет многоуровневую архитектуру, разделенную на ядро (core), графический интерфейс (gui) и инструменты (tools).
Ядро (Core): Содержит всю низкоуровневую логику для взаимодействия с игрой. Это включает в себя работу с памятью процесса, установку хуков, управление игровыми объектами, навигацию и исполнение движений. Модули ядра спроектированы так, чтобы быть независимыми от UI.
GUI: Построено на Qt6 и предоставляет пользователю средства для управления ботом. Каждый экземпляр бота отображается в отдельной вкладке, что позволяет управлять несколькими окнами игры одновременно. GUI взаимодействует с ядром через четко определенные классы и сигналы/слоты Qt.
Многопоточность: Каждый объект Bot работает в своем собственном потоке (QThread). Это обеспечивает отзывчивость UI и позволяет основной логике бота выполняться независимо, не блокируя главный поток приложения. Асинхронные задачи, такие как поиск пути, вынесены в отдельный пул потоков для максимальной производительности.

Структура проекта
.
├── CMakeLists.txt
├── README.md
├── src
│   ├── main.cpp
│   ├── core
│   │   ├── CMakeLists.txt
│   │   ├── Logging
│   │   │   ├── Logging.cpp
│   │   │   └── Logging.h
│   │   ├── MemoryManager
│   │   │   ├── MemoryManager.cpp
│   │   │   └── MemoryManager.h
│   │   ├── ProcessManager
│   │   │   ├── ProcessManager.cpp
│   │   │   └── ProcessManager.h
│   │   ├── HookManager
│   │   │   ├── HookManager.cpp
│   │   │   ├── HookManager.h
│   │   │   ├── Hook
│   │   │   │   ├── Hook.h
│   │   │   │   ├── InlineHook
│   │   │   │   │   ├── InlineHook.cpp
│   │   │   │   │   └── InlineHook.h
│   │   │   │   └── README.md
│   │   ├── Bot
│   │   │   ├── Bot.cpp
│   │   │   ├── Bot.h
│   │   │   ├── Hooks
│   │   │   │   ├── GetComputerNameHook.cpp
│   │   │   │   └── GetComputerNameHook.h
│   │   │   ├── Character
│   │   │   │   ├── Character.cpp
│   │   │   │   ├── Character.h
│   │   │   │   ├── CharacterHook.cpp
│   │   │   │   └── CharacterHook.h
│   │   │   ├── GameObjectManager
│   │   │   │   ├── GameObjectManager.cpp
│   │   │   │   ├── GameObjectManager.h
│   │   │   │   ├── Structures
│   │   │   │   │   ├── GameObject.h
│   │   │   │   │   ├── Player.h
│   │   │   │   │   └── Unit.h
│   │   │   │   └── Target
│   │   │   │       ├── TargetHook.cpp
│   │   │   │       └── TargetHook.h
│   │   │   └── Movement
│   │   │       ├── MovementManager.cpp
│   │   │       ├── MovementManager.h
│   │   │       ├── CtM
│   │   │       │   ├── CtM.cpp
│   │   │       │   ├── CtM.h
│   │   │       │   ├── CtMEnablerHook.cpp
│   │   │       │   └── CtMEnablerHook.h
│   │   │       ├── Pathfinder
│   │   │       │   ├── Pathfinder.cpp
│   │   │       │   └── Pathfinder.h
│   │   │       └── Teleport
│   │   │           ├── TeleportExecutor.cpp
│   │   │           ├── TeleportExecutor.h
│   │   │           ├── TeleportStepFlagHook.cpp
│   │   │           └── TeleportStepFlagHook.h
│   │   ├── Navigation
│   │   │   ├── NavMeshManager.cpp
│   │   │   ├── NavMeshManager.h
│   │   │   ├── PathfindingService.cpp
│   │   │   └── PathfindingService.h
│   │   └── Utils
│   │       └── Vector.h
│   └── gui
│       ├── MainWindow.cpp
│       ├── MainWindow.h
│       ├── Logging
│       │   ├── LogWindow.cpp
│       │   └── LogWindow.h
│       ├── ProcessManager
│       │   ├── ProcessListDialog.cpp
│       │   └── ProcessListDialog.h
│       └── Bot
│           ├── BotWidget.cpp
│           ├── BotWidget.h
│           ├── CharacterWidget
│           │   ├── CharacterWidget.cpp
│           │   └── CharacterWidget.h
│           └── MainWidget
│               ├── MainWidget.cpp
│               └── MainWidget.h
└── tools
    └── MDHack
        └── CMakeLists.txt


Описание библиотек и модулей
Главный исполняемый файл (MDBot2)
Основная точка входа в приложение. Отвечает за инициализацию Qt, создание главного окна и запуск цикла обработки событий. Линкуется со всеми Core_* библиотеками и внешними зависимостями для создания финального .exe файла.
Core-библиотеки (src/core)
Это статические библиотеки, которые содержат всю основную логику бота. Они компилируются независимо и затем линкуются с основным приложением.
Core_MemoryManager
Назначение: Фундаментальная библиотека для взаимодействия с памятью другого процесса.
Функционал: Предоставляет инкапсулированный доступ к функциям WinAPI, таким как OpenProcess, ReadProcessMemory, WriteProcessMemory, VirtualAllocEx, VirtualFreeEx. Является основой для всех остальных модулей, работающих с игрой.
Core_ProcessManager
Назначение: Поиск и перечисление процессов в системе.
Функционал: Статический класс, который позволяет найти все процессы по имени исполняемого файла (например, run.exe). Используется в GUI для предоставления пользователю списка доступных окон игры.
Core_HookManager
Назначение: Управление перехватом функций (хуками) в целевом процессе.
Архитектура: Реализует концепцию "Inline Hook" (или "Trampoline Hook").
Hook: Абстрактный базовый класс для всех типов хуков.
InlineHook: Базовая реализация inline-хука. Он динамически вычисляет размер заменяемых инструкций с помощью Capstone, чтобы не повредить код функции, устанавливает JMP на свой обработчик (трамплин) и сохраняет оригинальные байты для последующего восстановления.
Конкретные реализации:
GetComputerNameHook: Перехватывает вызов GetComputerNameA для обхода систем защиты клиента игры.
CharacterHook: Перехватывает функцию, работающую со структурой персонажа, чтобы получить указатель на нее (base address).
TargetHook: Аналогично CharacterHook, получает указатель на структуру текущей цели игрока.
CtMEnablerHook: Активирует в клиенте функцию "Click-to-Move", которая по умолчанию может быть отключена.
TeleportStepFlagHook: Низкоуровневый хук для реализации безопасного пошагового телепорта.
Core_Character
Назначение: Управление данными игрового персонажа.
Функционал: Хранит и обновляет информацию о персонаже: уровень, здоровье, ману, координаты, ID карты. Использует CharacterHook для получения базового адреса структуры персонажа в памяти и затем читает данные по известным смещениям (offsets).
Core_GameObject
Назначение: Управление всеми видимыми игровыми объектами.
Функционал: Реализует "Object Manager", который обходит внутренний связанный список объектов в памяти игры. Он кэширует информацию об объектах (игроках, NPC, руде, траве) и предоставляет к ней доступ. Использует TargetHook для определения текущей цели игрока.
Core_Navigation
Назначение: Обеспечение навигации и поиска пути в игровом мире.
Архитектура: Состоит из трех ключевых компонентов:
NavMeshManager: Синглтон, управляющий загрузкой навигационных сеток (.navmesh файлов), сгенерированных с помощью Recast/Detour. Он динамически подгружает с диска только те "тайлы" сетки, которые находятся вокруг игрока, для экономии памяти.
Pathfinder: Утилитарный класс, который выполняет сам алгоритм поиска пути (A*) на предоставленной навигационной сетке.
PathfindingService: Высокопроизводительный сервис, управляющий пулом потоков. Он принимает асинхронные запросы на поиск пути, выполняет их в фоновом режиме и возвращает результат через callback. Это предотвращает "зависание" бота во время сложных вычислений пути.
Core_Teleport
Назначение: Реализация функционала телепортации.
Функционал: Содержит TeleportExecutor, который выполняет пошаговую телепортацию к цели, записывая новые координаты в память. Для синхронизации с клиентом игры используется TeleportStepFlagHook.
Модуль Bot (src/core/Bot)
Это центральный класс, объединяющий все core-библиотеки для управления одним конкретным персонажем.
Bot.h/.cpp: Класс Bot инкапсулирует в себе MemoryManager, HookManager, Character, GameObjectManager и MovementManager. Каждый экземпляр Bot ассоциирован с одним PID процесса игры и выполняется в отдельном потоке (QThread).
MovementManager.h/.cpp: Высокоуровневый менеджер движений. Он принимает команду "двигаться в точку", запрашивает путь у PathfindingService, а затем использует CtmExecutor (Click-To-Move) для перемещения по точкам полученного пути.
CtmExecutor.h/.cpp: Низкоуровневый исполнитель Click-To-Move. Напрямую записывает в память координаты и тип действия (идти, атаковать, собирать лут).
Графический интерфейс (src/gui)
Модули, отвечающие за визуальное представление и взаимодействие с пользователем.
MainWindow: Главное окно приложения. Использует QTabWidget для отображения нескольких BotWidget, по одному на каждый запущенный бот.
ProcessListDialog: Диалоговое окно для выбора процесса run.exe, к которому будет подключен бот. Также позволяет указать поддельное имя компьютера.
LogWindow: Отдельное окно для отображения логов приложения в реальном времени.
BotWidget: Виджет, представляющий одну вкладку для одного бота. Содержит в себе MainWidget (кнопки Старт/Стоп) и CharacterWidget (информация о персонаже).
CharacterWidget: Отображает детальную информацию о персонаже (HP, мана, позиция) и содержит кнопки для тестирования навигации.
MainWidget: Предоставляет основные элементы управления ботом: кнопки "Старт", "Стоп" и метку текущего статуса.
Инструменты (tools)
MDHack
Назначение: Вспомогательный проект. Судя по названию, может являться инжектором DLL, отдельным инструментом для анализа памяти или другой утилитой, связанной с основной задачей бота. (Конкретные исходные файлы не предоставлены).