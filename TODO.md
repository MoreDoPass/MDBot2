# План работ по Навигации: Текущий статус

## I. Архитектура асинхронной навигации (Выполнено)

- [✔] **1. Реализован `NavMeshManager` с поддержкой тайлов:**
    - [✔] `NavMeshManager` переделан для работы с `dtTileCache`.
    - [✔] Реализована система динамической загрузки тайлов (`.navmesh`) с диска по мере необходимости.
- [✔] **2. `Pathfinder` сделан независимым:**
    - [✔] `Pathfinder` теперь является "чистой" утилитой и не занимается загрузкой файлов или хранением состояния.
- [✔] **3. Реализован `PathfindingService`:**
    - [✔] Создан потокобезопасный сервис с пулом потоков для выполнения запросов в фоне.
- [✔] **4. Система интегрирована в `MovementManager`:**
    - [✔] `MovementManager` теперь отправляет асинхронные запросы на поиск пути.
    - [✔] Реализована базовая логика следования по пути (`PathExecutor` на основе `QTimer`).

---

## II. Подготовка и размещение данных (Осталось сделать)

- [ ] **1. Сгенерировать тайловые NavMesh'ы:**
    - [ ] С помощью `NavMeshTool` создать файлы тайлов (например, `32_31.navmesh`) для тестовой карты.
- [ ] **2. Разместить файлы NavMesh в директории сборки:**
    - [ ] **Задача:** Создать папку `navmeshes` рядом с `MDBot2.exe`.
    - [ ] **Задача:** Внутри `navmeshes` создать папки, названные по ID карт (например, `0`, `530`).
    - [ ] **Задача:** Положить сгенерированные `.navmesh` тайлы в соответствующую папку карты.
- [ ] **3. (Опционально) Настроить параметры NavMesh:**
    - [ ] В `NavMeshManager::initTileCache` сейчас захардкожены параметры (orig, tileWidth и т.д.). Для первого теста это нормально, но в будущем их лучше вынести в конфиг.

---

## III. Интеграция с данными игры (Осталось сделать)

- [ ] **1. Реализовать получение координат и ID карты:**
    - [ ] **Задача:** В `MovementManager` заменить все заглушки `// TODO` на реальные вызовы функций, читающих позицию (X, Y, Z) и ID карты персонажа из памяти игры.
- [ ] **2. Реализовать обновление `NavMeshManager`:**
    - [ ] **Задача:** В цикле обновления `MovementManager` (`updatePathExecution`) добавить вызов:
      `NavMeshManager::getInstance().update(mapId, currentPos);`
    - [ ] **Пояснение:** Это будет сообщать `NavMeshManager`-у, где находится игрок, чтобы тот мог подгружать нужные тайлы вокруг него.

---

## IV. Тестирование (Осталось сделать)

- [ ] **1. Создать тестовый триггер:**
    - [ ] **Задача:** Добавить способ запустить навигацию, например, кнопкой в GUI или временным кодом, который вызовет `movementManager->moveTo(X, Y, Z, settings)`.
- [ ] **2. Провести сквозное тестирование:**
    - [ ] **Задача:** Запустить бота, активировать триггер и убедиться по логам и поведению в игре, что вся цепочка от запроса до движения по пути работает корректно.
