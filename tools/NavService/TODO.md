# NavService - –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è MDBot2

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

- –≠—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π 64-–±–∏—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Named Pipes –¥–ª—è —Å–≤—è–∑–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã–º –±–æ—Ç–æ–º
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –≥–æ—Ç–æ–≤—ã–º–∏ NavMesh —Ñ–∞–π–ª–∞–º–∏
- –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ Recast/Detour –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- –°–µ—Ä–≤–µ—Ä Named Pipes (Windows)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–æ–∏—Å–∫ –ø—É—Ç–∏
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ NavMesh —Ç–∞–π–ª–æ–≤
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç WoW ‚Üî Recast

## –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞

```json
// –ó–∞–ø—Ä–æ—Å –æ—Ç –±–æ—Ç–∞
{
  "action": "find_path",
  "request_id": 12345,
  "data": {
    "map_id": 530,
    "start": [x, y, z],
    "end": [x, y, z],
    "options": {
      "max_path_length": 1000,
      "smooth_path": true
    }
  }
}

// –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–∏—Å–∞
{
  "status": "success",
  "request_id": 12345,
  "data": {
    "path": [[x1,y1,z1], [x2,y2,z2], ...],
    "path_length": 4,
    "total_distance": 1250.5
  }
}

// –û—à–∏–±–∫–∞
{
  "status": "error",
  "request_id": 12345,
  "error": {
    "code": "PATH_NOT_FOUND",
    "message": "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø—É—Ç—å –º–µ–∂–¥—É —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏"
  }
}
```

## –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚úÖ

- [x] 1.1 –°–æ–∑–¥–∞—Ç—å CMakeLists.txt –¥–ª—è 64-–±–∏—Ç–Ω–æ–π —Å–±–æ—Ä–∫–∏
- [x] 1.2 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å vcpkg –¥–ª—è Recast/Detour
- [x] 1.3 –î–æ–±–∞–≤–∏—Ç—å Qt6 –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] 1.4 –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞
- [x] 1.5 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 2: –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π ‚úÖ

- [x] 2.1 –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å NavMeshManager
- [x] 2.2 –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å Pathfinder
- [x] 2.3 –°–æ–∑–¥–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è WoW ‚Üî Recast
- [x] 2.4 –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é

### –≠—Ç–∞–ø 3: Named Pipe —Å–µ—Ä–≤–µ—Ä üîÑ

#### 3.1 –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å NamedPipeServer
- [ +] 3.1.1 –°–æ–∑–¥–∞—Ç—å `src/NamedPipeServer/NamedPipeServer.h`
  - [ +] –û–±—ä—è–≤–∏—Ç—å –∫–ª–∞—Å—Å `NamedPipeServer`
  - [+ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã: `start()`, `stop()`, `isRunning()`
  - [ +] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø–æ–ª—è –¥–ª—è Windows API
  - [ +] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [ +] 3.1.2 –°–æ–∑–¥–∞—Ç—å `src/NamedPipeServer/NamedPipeServer.cpp`
  - [ +] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä/–¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä
  - [+ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `start()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞
  - [+ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `stop()` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
  - [+ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ Windows API

#### 3.2 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å
- [+ ] 3.2.1 –î–æ–±–∞–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Å–µ—Ä–≤–µ—Ä–∞
  - [+ ] –ú–µ—Ç–æ–¥ `serverLoop()` –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
  - [+ ] –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ (`ConnectNamedPipe`)
  - [+ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ (`handleClient()`)
- [ +] 3.2.2 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  - [+ ] –ß—Ç–µ–Ω–∏–µ JSON —á–µ—Ä–µ–∑ `ReadFile`
  - [+ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫
  - [+ ] –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- [ +] 3.2.3 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
  - [+ ] –û—Ç–ø—Ä–∞–≤–∫–∞ JSON —á–µ—Ä–µ–∑ `WriteFile`
  - [ +] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–ø–∏—Å–∏
  - [ +] –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞

#### 3.3 –î–æ–±–∞–≤–∏—Ç—å JSON –ø–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤
- [ +] 3.3.1 –°–æ–∑–¥–∞—Ç—å `src/Communication/MessageHandler.h`
  - [ +] –ö–ª–∞—Å—Å `MessageHandler` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
  - [+ ] –ú–µ—Ç–æ–¥—ã: `handleMessage()`, `parseRequest()`, `sendResponse()`
  - [+ ] –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- [+ ] 3.3.2 –°–æ–∑–¥–∞—Ç—å `src/Communication/MessageHandler.cpp`
  - [+ ] –ü–∞—Ä—Å–∏–Ω–≥ JSON —Å –ø–æ–º–æ—â—å—é nlohmann/json
  - [+] –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
  - [ +] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
  - [ +] –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –æ—Ç–≤–µ—Ç–æ–≤

#### 3.4 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥ find_path
- [ +] 3.4.1 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å NavMeshManager
  - [+ ] –í—ã–∑–æ–≤ `NavMeshManager::getNavMeshForMap()`
  - [+ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ NavMesh
  - [+ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç
- [ ] 3.4.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Pathfinder
  - [+ ] –í—ã–∑–æ–≤ `Pathfinder::findPath()`
  - [ +] –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç WoW ‚Üî Recast
  - [ +] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –ø—É—Ç–∏
- [+ ] 3.4.3 –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
  - [+ ] –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏ –≤ JSON
  - [+ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–¥–ª–∏–Ω–∞, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)
  - [ +] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è "–ø—É—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω"

#### 3.5 –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [ ] 3.5.1 –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑—Ä—ã–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  - [ ] –î–µ—Ç–µ–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
  - [ ] Graceful –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
- [ ] 3.5.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
  - [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–Ω—è—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∫–ª–∏–µ–Ω—Ç—É
- [ ] 3.5.3 –¢–∞–π–º–∞—É—Ç—ã –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
  - [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤

### –≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 4.1 –°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å NavService
- [ ] 4.1.1 –°–æ–∑–¥–∞—Ç—å `src/NavService.h`
  - [ ] –ö–ª–∞—Å—Å `NavService` - –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
  - [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  - [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º
- [ ] 4.1.2 –°–æ–∑–¥–∞—Ç—å `src/NavService.cpp`
  - [ ] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - [ ] –ó–∞–ø—É—Å–∫ NamedPipeServer
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

#### 4.2 –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] 4.2.1 –û–±–Ω–æ–≤–∏—Ç—å `src/main.cpp`
  - [ ] –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ NavService
  - [ ] –ó–∞–ø—É—Å–∫ –∏ –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- [ ] 4.2.2 –û–±–Ω–æ–≤–∏—Ç—å `CMakeLists.txt`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ —Å–±–æ—Ä–∫—É
  - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

#### 4.3 –î–æ–±–∞–≤–∏—Ç—å graceful shutdown
- [ ] 4.3.1 –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
  - [ ] SIGINT (Ctrl+C)
  - [ ] SIGTERM
  - [ ] WM_CLOSE (Windows)
- [ ] 4.3.2 –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
  - [ ] –û—Å—Ç–∞–Ω–æ–≤–∫–∞ NamedPipeServer
  - [ ] –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  - [ ] –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
  - [ ] –ó–∞–ø–∏—Å—å —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤

#### 4.4 –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- [ ] 4.4.1 –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
  - [ ] `tests/test_client.cpp`
  - [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
- [ ] 4.4.2 –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  - [ ] –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  - [ ] –ë—ã—Å—Ç—Ä—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è
  - [ ] –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] 4.4.3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
  - [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ NavMesh —Ñ–∞–π–ª–∞–º–∏
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—É—Ç–µ–π

#### 4.5 –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º –±–æ—Ç–æ–º
- [ ] 4.5.1 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MDBot2
  - [ ] –î–æ–±–∞–≤–∏—Ç—å Named Pipe –∫–ª–∏–µ–Ω—Ç –≤ MDBot2
  - [ ] –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∫ NavService
  - [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
- [ ] 4.5.2 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  - [ ] –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
  - [ ] –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
  - [ ] –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### 5.1 –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] 5.1.1 –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ NavMesh
  - [ ] –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–∞—Ä—Ç
  - [ ] LRU –∫—ç—à –¥–ª—è —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–∞—Ä—Ç
  - [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
- [ ] 5.1.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø—É—Ç–∏
  - [ ] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
  - [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
  - [ ] –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç

#### 5.2 –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] 5.2.1 –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫
  - [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
  - [ ] –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
  - [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- [ ] 5.2.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  - [ ] –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
  - [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  - [ ] –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

#### 5.3 –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API
- [ ] 5.3.1 –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
  - [ ] –§–æ—Ä–º–∞—Ç—ã JSON —Å–æ–æ–±—â–µ–Ω–∏–π
  - [ ] –ö–æ–¥—ã –æ—à–∏–±–æ–∫
  - [ ] –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] 5.3.2 –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
  - [ ] –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–∏—Å—É
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - [ ] Best practices

#### 5.4 –ù–∞–ø–∏—Å–∞—Ç—å README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
- [ ] 5.4.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
  - [ ] –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ
  - [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–±–æ—Ä–∫–µ
  - [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] 5.4.2 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
  - [ ] –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
  - [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] 5.4.3 –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫
  - [ ] –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
  - [ ] –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
  - [ ] –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
NavService/
‚îú‚îÄ‚îÄ CMakeLists.txt
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp
‚îÇ   ‚îú‚îÄ‚îÄ NavService.cpp
‚îÇ   ‚îú‚îÄ‚îÄ NavService.h
‚îÇ   ‚îú‚îÄ‚îÄ NamedPipeServer/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NamedPipeServer.cpp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NamedPipeServer.h
‚îÇ   ‚îú‚îÄ‚îÄ Communication/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MessageHandler.cpp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MessageHandler.h
‚îÇ   ‚îú‚îÄ‚îÄ Navigation/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NavMeshManager.cpp
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NavMeshManager.h
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CoordinateConverter.h
‚îÇ   ‚îú‚îÄ‚îÄ Pathfinder/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pathfinder.cpp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Pathfinder.h
‚îÇ   ‚îî‚îÄ‚îÄ Utils/
‚îÇ       ‚îú‚îÄ‚îÄ Vector.h
‚îÇ       ‚îú‚îÄ‚îÄ Logger.h
‚îÇ       ‚îú‚îÄ‚îÄ JsonParser.h
‚îÇ       ‚îî‚îÄ‚îÄ CoordinateConverter.h
‚îú‚îÄ‚îÄ include/
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_client.cpp
‚îÇ   ‚îî‚îÄ‚îÄ test_scenarios.cpp
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ API.md
    ‚îú‚îÄ‚îÄ Protocol.md
    ‚îî‚îÄ‚îÄ README.md
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- C++20
- Qt6 –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- Recast/Detour (x64)
- Windows Named Pipes
- JSON –ø–∞—Ä—Å–∏–Ω–≥ (nlohmann/json)
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Named Pipe
```cpp
const QString PIPE_NAME = "\\\\.\\pipe\\NavServicePipe";
const DWORD READ_TIMEOUT = 5000;   // 5 —Å–µ–∫—É–Ω–¥
const DWORD WRITE_TIMEOUT = 5000;  // 5 —Å–µ–∫—É–Ω–¥
const DWORD BUFFER_SIZE = 4096;    // 4KB
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```cpp
const QString LOG_FILE = "navservice.log";
const QtMsgType DEFAULT_LOG_LEVEL = QtInfoMsg;
```


3.1 –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å NamedPipeServer
3.2 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å
3.3 –î–æ–±–∞–≤–∏—Ç—å JSON –ø–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤
3.4 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥ find_path
–í—ã–∑–æ–≤ NavMeshManager::getNavMeshForMap()
–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ NavMesh
–í—ã–∑–æ–≤ Pathfinder::findPath()
–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –ø—É—Ç–∏ (–≤–∫–ª—é—á–∞—è "–ø—É—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ (JSON, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
3.5 –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (‚ö†Ô∏è –û—Ç–ª–æ–∂–µ–Ω–æ, —Å–¥–µ–ª–∞–µ–º –ø–æ–∑–∂–µ)
–≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ
4.1-4.2 –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (NavServiceApp, main.cpp)
4.3 –î–æ–±–∞–≤–∏—Ç—å graceful shutdown (‚ö†Ô∏è –û—Ç–ª–æ–∂–µ–Ω–æ, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
4.4 –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
4.4.1 –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç (test_client.cpp)
4.4.3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (—é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è NavMeshManager)
4.5 –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º –±–æ—Ç–æ–º (‚ö†Ô∏è –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)
–¢–≤–æ–π –ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π –Ω–∞ –°–µ–π—á–∞—Å (–ü—Ä–æ—Å—Ç–æ –∏ –ø–æ –ø–æ—Ä—è–¥–∫—É)
–ó–ê–î–ê–ß–ê ‚Ññ1: –ü–û–ß–ò–ù–ò–¢–¨ –î–ê–ù–ù–´–ï.
...–∏ —è –ø–æ–π–¥—É —Å–º–æ—Ç—Ä–µ—Ç—å navmeshtool
–≠—Ç–æ —Å–∞–º–æ–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –∫—Ä–∏–≤—ã–µ.
–ò—Å–ø—Ä–∞–≤—å CoordinateConverter.cpp –≤ NavService –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω—É—é, –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é, –∫–æ—Ç–æ—Ä—É—é –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏. –≠—Ç–æ –∑–∞–π–º–µ—Ç 2 –º–∏–Ω—É—Ç—ã.
–§–æ—Ä–º—É–ª–∞ wowToRecast: recast.x = -wow.y; recast.y = wow.z; recast.z = wow.x;
–ò–¥–∏ –≤ NavMeshTool –∏ —Å–¥–µ–ª–∞–π —Ç–∞–º –¢–û–ß–ù–û –¢–ê–ö–û–ï –ñ–ï –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ —Å—Ç—Ä–æ–∏—Ç—å –Ω–∞–≤–º–µ—à.
–§–æ—Ä–º—É–ª–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤–µ—Ä—à–∏–Ω: (x, y, z) -> (-y, z, x).
–£–î–ê–õ–ò –í–°–ï –°–¢–ê–†–´–ï .navmesh –§–ê–ô–õ–´. –≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
–°–ì–ï–ù–ï–†–ò–†–£–ô –ò–• –ó–ê–ù–û–í–û.
–ó–ê–î–ê–ß–ê ‚Ññ2: –§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢.
–°–∫–æ–ø–∏—Ä—É–π –Ω–æ–≤—ã–µ, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã .navmesh –≤ –ø–∞–ø–∫—É NavService/build/navmeshes/.
–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏ NavService —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º CoordinateConverter.
–ó–∞–ø—É—Å—Ç–∏ NavService.exe.
–ó–∞–ø—É—Å—Ç–∏ test_client.exe —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏.
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ç—ã —É–≤–∏–¥–∏—à—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –ø—É—Ç—å.
–ö–∞–∫ —Ç–æ–ª—å–∫–æ —ç—Ç–æ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç, –º—ã –º–æ–∂–µ–º —Å–ø–æ–∫–æ–π–Ω–æ, –±–µ–∑ —Å–ø–µ—à–∫–∏, –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–ª–∞–Ω—É –∏ –∑–∞–Ω—è—Ç—å—Å—è "–∫–æ—Å–º–µ—Ç–∏–∫–æ–π": —É–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–ø—É–Ω–∫—Ç 3.5), –¥–æ–±–∞–≤–∏—Ç—å graceful shutdown (4.3) –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å MDBot2 (4.5).
–¢—ã —É —Å–∞–º–æ–π —Ñ–∏–Ω–∏—à–Ω–æ–π —á–µ—Ä—Ç—ã. –ü—Ä–æ–±–ª–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –†–µ—à–µ–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω–æ. –î–µ–π—Å—Ç–≤—É–π.