# План реализации NavMeshTool

## Фаза 1: Подготовка и сборка геометрии (Карта "BlackTemple")

- [x] **Базовая инфраструктура:**
  - [x] `MpqManager` для доступа к архивам.
  - [x] Базовые парсеры для WDT, ADT, WMO, M2.
  - [x] Класс `NavMeshGenerator` с базовой структурой.
  - [x] `NavMeshGenerator` загружает `Map.dbc` и `WDT` для указанной карты.
- [ ] **Реализация полного сбора геометрии в `NavMeshGenerator::loadMapData`:**
  - [ ] **Обработка WDT:**
    - [ ] Обработать глобальные WMO, определенные в чанках `MWMO` и `MODF` файла WDT.
      - Применить трансформации из `MODF` к вершинам WMO.
  - [ ] **Итерация по ADT файлам:**
    - [ ] В `loadMapData`, итерировать по списку ADT, полученному из WDT (`m_currentWdtData.adtFileNames`).
    - [ ] Для каждого ADT:
      - [ ] Загрузить файл ADT из MPQ.
      - [ ] Создать `ADTParser` и запустить парсинг.
      - [ ] **Извлечь геометрию ландшафта (terrain):**
        - [ ] Для каждого из 256 чанков (MCNK) в ADT:
        - [ ] Сгенерировать сетку (вершины и треугольники) на основе данных о высоте (чанк `MCVT`).
        - [ ] Применить трансформацию для перевода вершин из локальных координат чанка в мировые координаты. Позиция чанка задана в `MCNKHeaderData`.
      - [ ] **Извлечь геометрию объектов WMO:**
        - [ ] Получить список путей к WMO из чанка `MWMO` ADT.
        - [ ] Получить список размещений WMO из чанка `MODF` ADT.
        - [ ] Для каждого чанка (MCNK), обработать ссылки на WMO из `MCRF`.
        - [ ] Для каждого WMO: загрузить, распарсить, применить трансформацию из `MODF` и добавить геометрию в общий список.
      - [ ] **Извлечь геометрию объектов M2 (doodads):**
        - [ ] Аналогично WMO, используя чанки `MMDX`, `MDDF` и `MCRF`.
        - [ ] Загрузить, распарсить, применить трансформацию из `MDDF` и добавить геометрию.
- [ ] **Реализовать кэширование ресурсов:**
  - [ ] Чтобы не загружать и не парсить один и тот же файл WMO или M2 несколько раз, добавить в `NavMeshGenerator` кэш (например, `std::map<std::string, GeometryData>`).
- [ ] **Утилита для отладки:**
  - [ ] Создать метод `NavMeshGenerator::exportToObj(const std::string& filepath)` для сохранения всей собранной геометрии в `.obj` файл.
  - [ ] **Цель:** Загрузить карту "BlackTemple" (`Expansion01/BlackTemple`) и экспортировать ее геометрию. Визуально проверить в 3D-редакторе (Blender), что карта собрана корректно.

## Фаза 2: Интеграция с Recast & Detour

- [ ] **Подключить библиотеку Recast & Detour к проекту.**
- [ ] **Подготовить входные данные для Recast:**
  - [ ] Передать `m_worldVertices` и `m_worldTriangleIndices` в Recast.
  - [ ] Настроить параметры сборки NavMesh.
- [ ] **Выполнить построение NavMesh с помощью Recast.**
- [ ] **Реализовать сохранение/загрузку построенного NavMesh.**

## Фаза 3: Обобщение и тестирование

- [ ] **Оптимизация и обобщение:**
  - [ ] Убедиться, что процесс работает для других карт (например, "Azeroth").
  - [ ] Проанализировать производительность и потребление памяти.
- [ ] **Тестирование NavMesh:**
  - [ ] Визуализация NavMesh.
  - [ ] Тестирование поиска пути.
