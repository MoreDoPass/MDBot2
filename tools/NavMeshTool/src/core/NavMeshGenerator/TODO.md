# План работ для NavMeshGenerator

Этот файл описывает высокоуровневый план по реализации `NavMeshGenerator`. Он зависит от рефакторинга отдельных парсеров.

## Фаза 1: Рефакторинг зависимостей (Парсеры)

- [x] Рефакторинг `WDTParser` (Завершено)
- [x] Рефакторинг `ADTParser` (см. `ADT/TODO.md`)
- [x] Рефакторинг `M2Parser` (см. `M2/TODO.md`)
- [ ] Рефакторинг `WMOParser` (см. `WMO/TODO.md`)

## Фаза 2: Реализация логики загрузки геометрии в `NavMeshGenerator`

- [ ] **Итерация по ADT файлам:**
  - [ ] В `loadMapData`, после успешного парсинга WDT, создать цикл по `m_currentWdtData.adtFileNames`.
  - [ ] Для каждого имени ADT файла:
    - [ ] Сформировать полный путь (например, `World\Maps\BlackTemple\BlackTemple_30_30.adt`).
    - [ ] Прочитать файл в буфер с помощью `m_mpqManager`.
    - [ ] Вызвать `m_adtParser.parse(buffer)`, получить `std::optional<ADTData>`.

- [ ] **Обработка данных из ADT:**
  - [ ] Извлечь вертексы и индексы ландшафта из `ADTData`.
  - [ ] **(Сложно)** Выполнить трансформацию вершин ландшафта в мировые координаты.
  - [ ] Добавить трансформированные вершины и индексы в `m_worldVertices` и `m_worldTriangleIndices`.

- [ ] **Обработка WMO и M2 из ADT:**
  - [ ] `ADTData` будет содержать списки WMO и M2 моделей, размещенных на данном чанке карты.
  - [ ] Для каждого WMO:
    - [ ] Прочитать корневой `.wmo` файл в буфер.
    - [ ] **(Ключевая архитектура)** Создать `fileProvider` (лямбда-функцию), который `WMOParser` будет использовать для запроса групповых WMO и M2 моделей. Этот `fileProvider` должен использовать `m_mpqManager` для чтения файлов.
    - [ ] Вызвать `m_wmoParser.parse(rootWmoBuffer, fileProvider)`.
    - [ ] Обработать геометрию из полученного `WmoData`, трансформировать её согласно информации о размещении из ADT и добавить в общие векторы.
  - [ ] Сделать аналогичную процедуру для M2 моделей.

- [ ] **Обработка глобальных WMO:**
  - [ ] После обработки всех ADT, взять список глобальных WMO из `m_currentWdtData.mwmoFilenames` и `m_currentWdtData.modfEntries`.
  - [ ] Загрузить и обработать их так же, как и WMO из ADT, используя информацию о размещении из чанка `MODF`.

## Фаза 3: Построение NavMesh

- [ ] Когда вся геометрия карты собрана в `m_worldVertices` и `m_worldTriangleIndices`:
  - [ ] Передать эти данные в библиотеку Recast & Detour.
  - [ ] Настроить параметры построения сетки (размер агента, высота и т.д.).
  - [ ] Запустить процесс построения NavMesh.
  - [ ] Сохранить готовую навигационную сетку в файл.
